<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mycompany.healthcare.dao.ReceiptAndOpinionsDao">
	<insert id="insertReceipt" >
		insert into receipt_and_opinions
		(receipt_state, patient_id)
		values
		('대기', #{patient_id})
	</insert>

 	<select id="selectAllReceipt" resultType="receiptAndOpinions">
 		select p.patient_id, p.patient_name, p.patient_sex, p.patient_phone, 
 		 		rao.receipt_id, rao.receipt_state, rao.receipt_datetime
		from receipt_and_opinions rao, patients p
		where rao.patient_id = p.patient_id
	</select>
	
	<delete id="deleteReceiptById">
		delete from receipt_and_opinions
		where receipt_id = #{receipt_id}
	</delete>
	
	<update id="updateReceipt">
		update receipt_and_opinions
		set receipt_state = '진료중'
		where patient_id = #{patient_id}
	</update>
	
	<select id="selectSearchPatientIdOpinionList" resultType="receiptAndOpinions">
		select receipt_id, date_format(receipt_datetime, '%Y-%m-%d') as receipt_datetime, receipt_state, diagnostic_test_state, receipt_opinion, receipt_uniqueness, patient_id
		from receipt_and_opinions
		where patient_id = #{patient_id}
	</select>
	
	<select id="selectSearchDateOpinionList" resultType="receiptAndOpinions">
		select receipt_id, date_format(receipt_datetime, '%Y-%m-%d') as receipt_datetime, receipt_state, diagnostic_test_state, receipt_opinion, receipt_uniqueness, patient_id
		from receipt_and_opinions
		where receipt_datetime Like CONCAT('%', #{receipt_datetime}, '%')
	</select>
	
	<update id="updateReceiptState">
		update receipt_and_opinions
		set receipt_state = '검사중'
		where receipt_id = #{receipt_id}
	</update>
	
</mapper>
